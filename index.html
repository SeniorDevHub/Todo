<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">
    <title>Awesome To Do List</title>
    <style>
        *,
        *::after,
        *::before {
          box-sizing: border-box;
          margin: 0;
          padding: 0;
        }

        :root {
          --bg-color: rgb(246, 246, 246);
          --card-bg: white;
          --text-color: #333;
          --border-color: gray;
          --input-bg: white;
          --hover-bg: rgb(230, 230, 184);
          --completed-text: #9b9b9b;
        }

        [data-theme="dark"] {
          --bg-color: #1a1a1a;
          --card-bg: #2d2d2d;
          --text-color: #e0e0e0;
          --border-color: #555;
          --input-bg: #3d3d3d;
          --hover-bg: #4a4a4a;
          --completed-text: #888;
        }

        body {
          background-color: var(--bg-color);
          color: var(--text-color);
          transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* todolist list base */
        #toDoList {
          display: flex;
          flex-direction: column;
          width: 90%;
          max-width: 600px;
          height: auto;
          margin: 20px auto;
          background-color: var(--card-bg);
          box-shadow: 0 4px 20px 30px rgba(0, 0, 0, 0.137);
          border-radius: 8px;
          overflow: hidden;
        }

        @media (min-width: 768px) {
          #toDoList {
            width: 50%;
            margin: 50px auto;
          }
        }

        ::placeholder {
          font-family: 'inter', sans-serif;
          font-style: italic;
          font-size: 14px;
        }

        /* title base */
        .title {
          background: var(--card-bg);
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding-right: 23px;
          padding-left: 10px;
          height: 50px;
        }

        .title-controls {
          display: flex;
          align-items: center;
          gap: 10px;
        }

        .theme-toggle {
          background: none;
          border: none;
          cursor: pointer;
          color: var(--text-color);
          font-size: 16px;
          padding: 5px;
          border-radius: 4px;
          transition: background-color 0.3s ease;
        }

        .theme-toggle:hover {
          background-color: var(--hover-bg);
        }

        /* h1 text */
        .ttdl {
          font-family: 'inter', sans-serif;
          font-size: 15px;
          font-weight: 100;
          font-style: normal;
          padding-top: 8px;
        }

        /* icon */
        i {
          border: none;
          background: none;
          display: flex;
          justify-content: flex-end;
          cursor: pointer;
        }

        /* Filter buttons */
        .filter-buttons {
          display: flex;
          background-color: var(--card-bg);
          border-top: 1px solid var(--border-color);
          padding: 10px;
          gap: 5px;
        }

        .filter-btn {
          flex: 1;
          padding: 8px 12px;
          border: 1px solid var(--border-color);
          background-color: var(--card-bg);
          color: var(--text-color);
          cursor: pointer;
          font-family: 'inter', sans-serif;
          font-size: 14px;
          border-radius: 4px;
          transition: all 0.3s ease;
        }

        .filter-btn:hover {
          background-color: var(--hover-bg);
        }

        .filter-btn.active {
          background-color: var(--text-color);
          color: var(--card-bg);
        }

        /* task list base */
        #inputList {
          justify-content: space-between;
          align-items: center;
          background-color: var(--card-bg);
          height: 50px;
          padding-right: 10px;
          padding-left: 10px;
        }

        .inputTask {
          display: flex;
          flex-direction: row;
          justify-content: space-between;
          align-items: center;
          background-color: var(--card-bg);
          border-left: none;
          border-bottom: none;
          border-right: none;
          border-top: 1px solid var(--border-color);
          height: 50px;
          padding: 0 10px;
        }

        /* refresh icon */
        .inputTask i {
          rotate: 90deg;
          cursor: pointer;
        }

        /* input text  */
        #addList {
          width: 100%;
          height: 45px;
          border: none;
          background-color: var(--input-bg);
          color: var(--text-color);
        }

        .submiticon {
          padding: 2px;
        }

        .remove-edit {
          display: flex;
          justify-items: flex-end;
          margin-left: auto;
          padding-right: 23px;
          text-decoration: none;
        }

        /* Clear task button */
        #btnClear {
          height: 50px;
          color: var(--completed-text);
          border-left: none;
          border-bottom: none;
          border-right: none;
          border-top: 1px solid var(--border-color);
          background-color: var(--card-bg);
          font-size: 18px;
          font-family: 'inter', sans-serif;
          cursor: pointer;
          transition: background-color 0.3s ease;
        }

        #btnClear:hover {
          background-color: var(--hover-bg);
        }

        /* task list base */
        .list {
          background: var(--card-bg);
          display: flex;
          gap: 10px;
          align-items: center;
          height: 50px;
          border-top: 1px solid var(--border-color);
          padding-left: 10px;
          list-style: none;
        }

        /* text */
        .tasks label {
          font-family: 'inter', sans-serif;
          padding-left: 10px;
          width: 100%;
          color: var(--text-color);
        }

        /* text */
        .lists li:nth-child(3) {
          display: flex;
          justify-items: flex-end;
          margin-left: auto;
          padding-right: 15px;
          text-decoration: none;
        }

        /* text checkbox */
        input[type=checkbox]:checked + label {
          text-decoration: line-through;
          color: var(--completed-text);
        }

        /* text */
        input {
          font-family: 'inter', sans-serif;
          font-size: 15px;
          font-style: italic;
          font-weight: 100;
          color: var(--text-color);
        }

        /* text */
        input:focus {
          outline: none;
        }

        /* text */
        .text {
          height: 45px;
          width: 95%;
          padding-left: 5px;
          border: none;
          background-color: var(--input-bg);
          font-family: 'inter', sans-serif;
          font-size: 15px;
          color: var(--text-color);
        }

        .textcompleted {
          text-decoration: line-through;
          border: none;
          font-size: 17px;
          height: 45px;
          width: 95%;
          padding-left: 5px;
          color: var(--completed-text);
          background-color: var(--input-bg);
        }

        /* edit button */
        .edit_list_btn {
          cursor: pointer;
          border: none;
          background: none;
          color: var(--text-color);
        }

        /* remove button */
        .remove_btn {
          cursor: pointer;
          display: none;
          border: none;
          background: none;
          color: var(--text-color);
        }

        .checkbox {
          cursor: pointer;
        }

        .to-do {
          background: var(--card-bg);
          display: flex;
          gap: 10px;
          align-items: center;
          padding-left: 10px;
          list-style: none;
          border-bottom: 0.01px solid var(--border-color);
          transition: background-color 0.3s ease;
        }
    </style>
</head>

<body>
    <div id="toDoList">
        <div class="title">
            <h1 class="ttdl">Today's To Do List</h1>
            <div class="title-controls">
                <button id="theme-toggle" class="theme-toggle">
                    <i class="fa fa-moon icon"></i>
                </button>
                <i class="fa fa-arrows-rotate icon"></i>
            </div>
        </div>
        <form id="inputList" action="#" method="post">
        <div class="inputTask">
        <input id="addList" type="text" placeholder="Add to your to do list..." maxlength="80" required>
        <button class="submiticon" type="submit"> <i class="fa fa-arrow-turn-down icon"></i> </button>
        </div>
        </form>
        <div class="filter-buttons">
            <button class="filter-btn active" data-filter="all">All</button>
            <button class="filter-btn" data-filter="todo">Todo</button>
            <button class="filter-btn" data-filter="achieved">Achieved</button>
        </div>
        <div class="toDoListContainer"></div>
        <button id="btnClear" type="submit">Clear Completed Tasks</button>
    </div>

    <script>
        // DataList class
        class DataList {
          constructor(description, completed, index) {
            this.description = description;
            this.completed = completed;
            this.index = index;
          }
        }

        // Display class
        class Display {
          static currentFilter = 'all';

          static getToDoListFromStorage = () => {
            let toDoLists;
            if (JSON.parse(localStorage.getItem('LocalDataList')) === null) {
              toDoLists = [];
            } else {
              toDoLists = JSON.parse(localStorage.getItem('LocalDataList'));
            }
            return toDoLists;
          };

          static addListToStorage = (toDoLists) => {
            const item = JSON.stringify(toDoLists);
            localStorage.setItem('LocalDataList', item);
          };

          static newIndexNum = (toDoLists) => {
            toDoLists.forEach((item, i) => {
              item.index = i + 1;
            });
          }

          static deleteListData = (id) => {
            let toDoLists = this.getToDoListFromStorage();
            const ListItemToDelete = toDoLists[id];
            toDoLists = toDoLists.filter((item) => item !== ListItemToDelete);
            this.newIndexNum(toDoLists);
            this.addListToStorage(toDoLists);
          };

          static ListInputUpdate = (newDescription, id) => {
            const toDoLists = this.getToDoListFromStorage();
            const updateList = toDoLists[id];
            toDoLists.forEach((item) => {
              if (item === updateList) {
                item.description = newDescription;
              }
            });
            this.addListToStorage(toDoLists);
            this.showLists();
          };

          static removeToDoListBtn = () => {
            document.querySelectorAll('.remove_btn').forEach((button) => button.addEventListener('click', (event) => {
              event.preventDefault();
              let id;
              if (button.id > 0) {
                id = button.id - 1;
              } else {
                id = 0;
              }
              this.deleteListData(id);
              this.showLists();
            }));
          };

          static getFilteredTasks = () => {
            const allTasks = this.getToDoListFromStorage();
            switch (this.currentFilter) {
              case 'todo':
                return allTasks.filter(task => !task.completed);
              case 'achieved':
                return allTasks.filter(task => task.completed);
              case 'all':
              default:
                return allTasks;
            }
          };

          static setFilter = (filter) => {
            this.currentFilter = filter;
            this.showLists();
            this.updateFilterButtons();
          };

          static updateFilterButtons = () => {
            document.querySelectorAll('.filter-btn').forEach(btn => {
              btn.classList.remove('active');
              if (btn.dataset.filter === this.currentFilter) {
                btn.classList.add('active');
              }
            });
          };

          static toDoListsHtml = ({ description, index }, statusCheck, statusCompleted) => {
            const ul = document.createElement('ul');
            ul.className = 'to-do';
            ul.innerHTML = `
              <li><input class="checkbox" id="${index}" type="checkbox" ${statusCheck}></li> 
              <li><input id="LIST${index}" type="text" class="text${statusCompleted}" value="${description}" readonly></li>
              <li class="remove-edit">
              <button class="edit_list_btn" id="${index}"><i class="fa fa-ellipsis-v icon"></i></button>
              <button class="remove_btn" id="${index}"><i class="fa fa-trash-can icon"></i></button>
              </li>
            `;
            return ul;
          }

          static showLists = () => {
            const toDoLists = this.getFilteredTasks();
            document.querySelector('.toDoListContainer').innerHTML = '';
            toDoLists.forEach((item) => {
              let statusCheck;
              let statusCompleted;
              if (item.completed === true) {
                statusCheck = 'checked';
                statusCompleted = 'completed';
              } else {
                statusCheck = '';
                statusCompleted = '';
              }
              document.querySelector('.toDoListContainer').appendChild(this.toDoListsHtml(item, statusCheck, statusCompleted));
            });

            this.removeToDoListBtn();
            this.editListBtnEvent();
            this.updateListBtnEvent();

            const event = new Event('listUpdated');
            document.dispatchEvent(event);
          };

          static addLists = (description) => {
            const toDoLists = this.getToDoListFromStorage();
            const index = toDoLists.length + 1;
            const newtask = new DataList(description, false, index);
            toDoLists.push(newtask);
            this.addListToStorage(toDoLists);
            this.showLists();
          }

          static updateListBtnEvent = () => {
            document.querySelectorAll('.text').forEach((input) => input.addEventListener('keypress', (event) => {
              if (event.key === 'Enter') {
                event.preventDefault();
                const inputListId = 'LIST';
                const ListIdSelected = event.currentTarget.id;
                let listID;

                if (!ListIdSelected.includes('LIST')) {
                  listID = inputListId.concat(ListIdSelected);
                } else {
                  listID = ListIdSelected;
                }

                document.getElementById(listID).setAttribute('readonly', 'readonly');
                this.ListInputUpdate(document.getElementById(listID).value, (Number(listID.replace('LIST', '')) - 1));
              }
            }));

            document.querySelectorAll('.text').forEach((input) => input.addEventListener('blur', (event) => {
              const inputListId = 'LIST';
              const ListIdSelected = event.currentTarget.id;
              let listID;

              if (!ListIdSelected.includes('LIST')) {
                listID = inputListId.concat(ListIdSelected);
              } else {
                listID = ListIdSelected;
              }

              document.getElementById(listID).setAttribute('readonly', 'readonly');
              this.ListInputUpdate(document.getElementById(listID).value, (Number(listID.replace('LIST', '')) - 1));
            }));
          }

          static editListBtnEvent = () => {
            let previousList = null;
            document.querySelectorAll('.edit_list_btn').forEach((button) => button.addEventListener('click', (event) => {
              event.preventDefault();
              const inputListId = 'LIST';
              const ListIdSelected = event.currentTarget.id;
              let listID;

              if (!ListIdSelected.includes('LIST')) {
                listID = inputListId.concat(ListIdSelected);
              } else {
                listID = ListIdSelected;
              }

              if (previousList !== null) {
                previousList.getElementById(listID).removeAttribute('readonly');
              }

              const listItem = event.target.closest('li');
              previousList = listItem;
              const ulItem = event.target.closest('ul');

              listItem.style.background = 'var(--hover-bg)';
              ulItem.style.background = 'var(--hover-bg)';

              document.getElementById(listID).removeAttribute('readonly');
              document.getElementById(listID).focus();
              document.getElementById(listID).style.background = 'var(--hover-bg)';
              listItem.querySelector('.edit_list_btn').style.display = 'none';
              listItem.querySelector('.remove_btn').style.display = 'block';
            }));
          };
        }

        // Interactive class
        class Interactive {
          static changeCompletedListCheck = (statusCheck, id) => {
            const toDoLists = Display.getToDoListFromStorage();
            toDoLists[id].completed = statusCheck;
            Display.addListToStorage(toDoLists);
            Display.showLists();
          }

          static checkStatusEvent = () => (
            document.querySelectorAll('.checkbox').forEach((checkbox) => checkbox.addEventListener('change', () => {
              let statusCheck;
              let id;
              if (checkbox.id > 0) {
                id = checkbox.id - 1;
              } else {
                id = 0;
              }

              if (checkbox.checked === true) {
                statusCheck = true;
              } else if (checkbox.checked !== true) {
                statusCheck = false;
              }

              this.changeCompletedListCheck(statusCheck, id);
            }))
          )

          static clearCompletedToDoLists = () => {
            let toDoLists = Display.getToDoListFromStorage();
            toDoLists = toDoLists.filter((item) => item.completed !== true);
            Display.newIndexNum(toDoLists);
            Display.addListToStorage(toDoLists);
            Display.showLists();
          }
        }

        // Initialize the app
        const inputList = document.getElementById('inputList');
        const addList = document.getElementById('addList');

        inputList.addEventListener('submit', (e) => {
          e.preventDefault();
          Display.addLists(addList.value);
          addList.value = '';
        });

        document.querySelector('#btnClear').addEventListener('click', Interactive.clearCompletedToDoLists);

        // Filter functionality
        document.querySelectorAll('.filter-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const filter = e.target.dataset.filter;
            Display.setFilter(filter);
          });
        });

        // Theme toggle functionality
        document.getElementById('theme-toggle').addEventListener('click', () => {
          const currentTheme = document.documentElement.getAttribute('data-theme');
          const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
          
          document.documentElement.setAttribute('data-theme', newTheme);
          localStorage.setItem('theme', newTheme);
          
          // Update icon
          const icon = document.querySelector('#theme-toggle i');
          icon.className = newTheme === 'dark' ? 'fa fa-sun icon' : 'fa fa-moon icon';
        });

        // Load saved theme on page load
        window.addEventListener('load', () => {
          const savedTheme = localStorage.getItem('theme') || 'light';
          document.documentElement.setAttribute('data-theme', savedTheme);
          
          const icon = document.querySelector('#theme-toggle i');
          icon.className = savedTheme === 'dark' ? 'fa fa-sun icon' : 'fa fa-moon icon';
          
          document.addEventListener('listUpdated', () => {
            Interactive.checkStatusEvent();
          }, false);
          Interactive.checkStatusEvent();
        });

        Display.showLists();
    </script>
</body>
</html>
